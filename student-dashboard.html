<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VR Class - Student Dashboard</title>
    <link rel="icon" href="Apple vision canvas images/favicon.png" type="image/x-icon" />
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #0a0a0a;
            background-image: 
                radial-gradient(circle at 20% 80%, rgba(0, 255, 136, 0.05) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(0, 255, 136, 0.03) 0%, transparent 50%),
                radial-gradient(circle at 40% 40%, rgba(255, 255, 255, 0.01) 0%, transparent 50%);
            min-height: 100vh;
            color: white;
            position: relative;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                linear-gradient(180deg, rgba(0, 0, 0, 0.8) 0%, rgba(0, 0, 0, 0.95) 100%),
                repeating-linear-gradient(
                    90deg,
                    transparent,
                    transparent 2px,
                    rgba(0, 255, 136, 0.01) 2px,
                    rgba(0, 255, 136, 0.01) 4px
                );
            pointer-events: none;
            z-index: -1;
        }

        /* Navigation Bar */
        .navbar {
            background: rgba(0, 0, 0, 0.95);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(0, 255, 136, 0.2);
            box-shadow: 0 2px 20px rgba(0, 0, 0, 0.8);
            padding: 18px 0;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
        }

        .nav-container {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 20px;
        }

        .logo {
            color: #00ff88;
            font-size: 1.8rem;
            font-weight: bold;
            text-shadow: 0 0 15px rgba(0, 255, 136, 0.6);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .logo::before {
            content: "üë®‚Äçüéì";
            font-size: 2rem;
        }

        .nav-menu {
            display: flex;
            gap: 20px;
            align-items: center;
        }

        .nav-button {
            background: rgba(0, 0, 0, 0.7);
            border: 1px solid rgba(0, 255, 136, 0.3);
            color: #00ff88;
            padding: 12px 24px;
            border-radius: 30px;
            text-decoration: none;
            font-weight: 600;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
            cursor: pointer;
            font-size: 0.95rem;
        }

        .nav-button:hover {
            background: rgba(0, 255, 136, 0.1);
            border-color: #00ff88;
            color: #00ff88;
            box-shadow: 0 0 25px rgba(0, 255, 136, 0.4);
            transform: translateY(-3px);
        }

        /* Main Container */
        .main-container {
            margin-top: 80px;
            padding: 20px;
            max-width: 1400px;
            margin-left: auto;
            margin-right: auto;
        }

        /* Header */
        .header {
            text-align: center;
            margin-bottom: 40px;
            padding: 40px;
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(20px);
            border-radius: 25px;
            border: 1px solid rgba(0, 255, 136, 0.2);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            position: relative;
        }

        .header h1 {
            font-size: 3rem;
            margin-bottom: 15px;
            color: #00ff88;
            text-shadow: 0 0 25px rgba(0, 255, 136, 0.6);
            font-weight: 700;
        }

        .header h1::before {
            content: "üéì ";
            font-size: 3.5rem;
        }

        .header p {
            font-size: 1.3rem;
            opacity: 0.9;
            color: #7FFFD4;
            font-weight: 500;
        }

        /* Notification Bell */
        .notification-bell {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(0, 255, 136, 0.2);
            border: 1px solid rgba(0, 255, 136, 0.4);
            border-radius: 50%;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1.5rem;
        }

        .notification-bell:hover {
            background: rgba(0, 255, 136, 0.3);
            transform: scale(1.1);
        }

        .notification-count {
            position: absolute;
            top: -5px;
            right: -5px;
            background: #ff4444;
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            font-weight: bold;
        }

        /* Dashboard Grid */
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 30px;
            margin-bottom: 40px;
        }

        .dashboard-card {
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(20px);
            border-radius: 25px;
            padding: 30px;
            border: 1px solid rgba(0, 255, 136, 0.15);
            transition: all 0.4s ease;
            cursor: pointer;
            position: relative;
            overflow: hidden;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }

        .dashboard-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(0, 255, 136, 0.05), transparent);
            transition: left 0.5s ease;
        }

        .dashboard-card:hover::before {
            left: 100%;
        }

        .dashboard-card:hover {
            background: rgba(0, 0, 0, 0.9);
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.4), 0 0 30px rgba(0, 255, 136, 0.2);
            border-color: rgba(0, 255, 136, 0.4);
        }

        .card-icon {
            font-size: 3.5rem;
            margin-bottom: 20px;
            display: block;
            filter: drop-shadow(0 0 10px rgba(0, 255, 136, 0.5));
        }

        .card-title {
            font-size: 1.6rem;
            margin-bottom: 12px;
            color: #00ff88;
            font-weight: 600;
            text-shadow: 0 0 15px rgba(0, 255, 136, 0.4);
        }

        .card-description {
            opacity: 0.8;
            line-height: 1.6;
            color: #C0C0C0;
        }

        /* Stats Cards */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 25px;
            margin-bottom: 40px;
        }

        .stat-card {
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 25px;
            text-align: center;
            border: 1px solid rgba(0, 255, 136, 0.2);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }

        .stat-card:hover {
            transform: translateY(-5px) scale(1.05);
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.4), 0 0 20px rgba(0, 255, 136, 0.2);
        }

        .stat-number {
            font-size: 2.8rem;
            font-weight: bold;
            color: #00ff88;
            margin-bottom: 8px;
            text-shadow: 0 0 15px rgba(0, 255, 136, 0.5);
        }

        .stat-label {
            opacity: 0.9;
            font-size: 1rem;
            color: #C0C0C0;
            font-weight: 500;
        }

        /* Modal Styles */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(15px);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .modal.show {
            opacity: 1;
            visibility: visible;
        }

        .modal-content {
            background: rgba(0, 0, 0, 0.95);
            backdrop-filter: blur(25px);
            border: 1px solid rgba(0, 255, 136, 0.2);
            border-radius: 20px;
            padding: 30px;
            max-width: 600px;
            width: 90%;
            max-height: 85vh;
            overflow-y: auto;
            transform: scale(0.7);
            transition: all 0.3s ease;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.5);
        }

        .modal.show .modal-content {
            transform: scale(1);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(0, 255, 136, 0.2);
        }

        .modal-title {
            font-size: 2rem;
            color: #00ff88;
            text-shadow: 0 0 15px rgba(0, 255, 136, 0.5);
            font-weight: 600;
        }

        .close-btn {
            background: none;
            border: none;
            color: white;
            font-size: 2rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .close-btn:hover {
            color: #ff6b6b;
            transform: scale(1.2);
        }

        /* Button Styles */
        .btn {
            padding: 15px 30px;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
            text-align: center;
        }

        .btn-primary {
            background: linear-gradient(45deg, #00ff88, #00cc6a);
            color: #000;
            font-weight: 600;
            box-shadow: 0 4px 15px rgba(0, 255, 136, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 30px rgba(0, 255, 136, 0.4);
            background: linear-gradient(45deg, #00cc6a, #00ff88);
        }

        .btn-secondary {
            background: rgba(0, 0, 0, 0.8);
            color: #00ff88;
            border: 1px solid rgba(0, 255, 136, 0.5);
            font-weight: 500;
        }

        .btn-secondary:hover {
            background: rgba(0, 255, 136, 0.1);
            border-color: #00ff88;
            color: #7FFFD4;
        }

        /* List Styles */
        .content-list {
            max-height: 400px;
            overflow-y: auto;
            border: 1px solid rgba(0, 255, 136, 0.2);
            border-radius: 10px;
            background: rgba(0, 0, 0, 0.5);
        }

        .content-item {
            padding: 20px;
            border-bottom: 1px solid rgba(0, 255, 136, 0.1);
            transition: all 0.3s ease;
        }

        .content-item:hover {
            background: rgba(0, 255, 136, 0.05);
        }

        .content-item:last-child {
            border-bottom: none;
        }

        .content-title {
            font-size: 1.2rem;
            color: #00ff88;
            margin-bottom: 8px;
            font-weight: 600;
        }

        .content-meta {
            font-size: 0.9rem;
            color: #C0C0C0;
            margin-bottom: 10px;
        }

        .content-description {
            color: #E0E0E0;
            line-height: 1.5;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
            
            .nav-menu {
                gap: 10px;
            }
            
            .nav-button {
                padding: 8px 15px;
                font-size: 0.9rem;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .modal-content {
                width: 95%;
                margin: 2% auto;
                max-height: 95vh;
                padding: 15px;
            }
        }

        /* Animation for cards */
        @keyframes slideInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .dashboard-card {
            animation: slideInUp 0.6s ease-out;
        }

        .dashboard-card:nth-child(2) {
            animation-delay: 0.1s;
        }

        .dashboard-card:nth-child(3) {
            animation-delay: 0.2s;
        }

        .dashboard-card:nth-child(4) {
            animation-delay: 0.3s;
        }
    </style>
</head>
<body>
    <!-- Navigation Bar -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="logo">üë®‚Äçüéì VR CLASS STUDENT</div>
            <div class="nav-menu">
                <a href="index.html" class="nav-button">Home</a>
                <a href="viksitVR.html" class="nav-button">ü•Ω VR Experience</a>
                <a href="quickmeet-master/public/index.html" class="nav-button">üé• Join Meeting</a>
                <a href="contact.html" class="nav-button">Contact</a>
                <button class="nav-button" onclick="logout()">Logout</button>
            </div>
        </div>
    </nav>

    <!-- Main Container -->
    <div class="main-container">
        <!-- Header -->
        <div class="header">
            <div class="notification-bell" onclick="openModal('notificationsModal')">
                üîî
                <div class="notification-count" id="notificationCount" style="display: none;">0</div>
            </div>
            <h1>Student Learning Hub</h1>
            <p id="studentWelcome">Welcome to your personalized VR learning experience!</p>
        </div>

        <!-- Stats Grid -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-number" id="assignmentsCount">0</div>
                <div class="stat-label">Active Assignments</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="quizzesCount">0</div>
                <div class="stat-label">Available Quizzes</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="completedCount">0</div>
                <div class="stat-label">Completed Tasks</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="averageScore">0%</div>
                <div class="stat-label">Average Score</div>
            </div>
        </div>

        <!-- Dashboard Grid -->
        <div class="dashboard-grid">
            <!-- Assignments Card -->
            <div class="dashboard-card" onclick="openModal('assignmentsModal')">
                <span class="card-icon">üìö</span>
                <h3 class="card-title">My Assignments</h3>
                <p class="card-description">View and submit assignments from your teachers. Track deadlines and submission status.</p>
            </div>

            <!-- Quizzes Card -->
            <div class="dashboard-card" onclick="openModal('quizzesModal')">
                <span class="card-icon">üìù</span>
                <h3 class="card-title">Take Quizzes</h3>
                <p class="card-description">Complete interactive quizzes and view your results and performance analytics.</p>
            </div>

            <!-- VR Classroom Card -->
            <div class="dashboard-card" onclick="window.location.href='viksitVR.html'">
                <span class="card-icon">ü•Ω</span>
                <h3 class="card-title">Enter VR Classroom</h3>
                <p class="card-description">Immerse yourself in virtual reality learning experiences and interactive lessons.</p>
            </div>

            <!-- Progress Tracker Card -->
            <div class="dashboard-card" onclick="openModal('progressModal')">
                <span class="card-icon">üìä</span>
                <h3 class="card-title">My Progress</h3>
                <p class="card-description">Track your learning progress, grades, and achievements across all subjects.</p>
            </div>

            <!-- Social Chat Card -->
            <div class="dashboard-card" onclick="window.location.href='social-chat.html'">
                <span class="card-icon">üí¨</span>
                <h3 class="card-title">Social Chat</h3>
                <p class="card-description">Connect with school friends! Send messages, share voice notes, and stay in touch with classmates.</p>
            </div>

            <!-- Study Groups Card -->
            <div class="dashboard-card" onclick="openModal('studyGroupsModal')">
                <span class="card-icon">üë•</span>
                <h3 class="card-title">Study Groups</h3>
                <p class="card-description">Join or create study groups with your classmates for collaborative learning sessions.</p>
            </div>
        </div>
    </div>

    <!-- Notifications Modal -->
    <div class="modal" id="notificationsModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">üîî Notifications</h2>
                <button class="close-btn" onclick="closeModal('notificationsModal')">&times;</button>
            </div>
            <div id="notificationsList" class="content-list">
                <!-- Notifications will be loaded here -->
            </div>
            <div style="margin-top: 20px; text-align: center;">
                <button class="btn btn-secondary" onclick="markAllAsRead()">Mark All as Read</button>
            </div>
        </div>
    </div>

    <!-- Assignments Modal -->
    <div class="modal" id="assignmentsModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">üìö My Assignments</h2>
                <button class="close-btn" onclick="closeModal('assignmentsModal')">&times;</button>
            </div>
            <div id="assignmentsList" class="content-list">
                <!-- Assignments will be loaded here -->
            </div>
        </div>
    </div>

    <!-- Quizzes Modal -->
    <div class="modal" id="quizzesModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">üìù Available Quizzes</h2>
                <button class="close-btn" onclick="closeModal('quizzesModal')">&times;</button>
            </div>
            <div id="quizzesList" class="content-list">
                <!-- Quizzes will be loaded here -->
            </div>
        </div>
    </div>

    <!-- Progress Modal -->
    <div class="modal" id="progressModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">üìä My Learning Progress</h2>
                <button class="close-btn" onclick="closeModal('progressModal')">&times;</button>
            </div>
            <div id="progressContent">
                <!-- Progress content will be loaded here -->
            </div>
        </div>
    </div>

    <!-- Quiz Taking Modal -->
    <div class="modal" id="quizTakingModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="quizTitle">üìù Taking Quiz</h2>
                <button class="close-btn" onclick="closeQuizModal()">&times;</button>
            </div>
            <div id="quizContent">
                <!-- Quiz content will be loaded here -->
            </div>
        </div>
    </div>

    <!-- Study Groups Modal -->
    <div class="modal" id="studyGroupsModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">üë• Study Groups</h2>
                <button class="close-btn" onclick="closeModal('studyGroupsModal')">&times;</button>
            </div>
            <div style="margin-bottom: 20px; text-align: center;">
                <button class="btn btn-primary" onclick="createStudyGroup()" style="margin-right: 10px;">
                    ‚ûï Create New Group
                </button>
                <button class="btn btn-secondary" onclick="joinStudyGroup()">
                    üîó Join Group
                </button>
            </div>
            <div id="studyGroupsList" class="content-list">
                <!-- Study groups will be loaded here -->
            </div>
        </div>
    </div>

    <script>
        let currentStudent = null;
        let currentQuiz = null;
        let quizStartTime = null;
        let quizAnswers = {};

        // Initialize student dashboard
        window.addEventListener('load', function() {
            currentStudent = JSON.parse(localStorage.getItem('vrClassCurrentUser') || 'null');
            
            if (!currentStudent || currentStudent.userType !== 'student') {
                alert('Access denied. Student login required.');
                window.location.href = 'index.html';
                return;
            }
            
            document.getElementById('studentWelcome').textContent = 
                `Welcome back, ${currentStudent.name}! Ready for your virtual learning adventure?`;
            
            loadDashboardData();
            loadNotifications();
            updateNotificationBell();
        });

        // Modal functions
        function openModal(modalId) {
            document.getElementById(modalId).classList.add('show');
            document.body.style.overflow = 'hidden';
            
            // Load specific content based on modal
            switch(modalId) {
                case 'assignmentsModal':
                    loadAssignments();
                    break;
                case 'quizzesModal':
                    loadQuizzes();
                    break;
                case 'progressModal':
                    loadProgress();
                    break;
                case 'notificationsModal':
                    displayNotifications();
                    break;
                case 'studyGroupsModal':
                    loadStudyGroups();
                    break;
            }
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('show');
            document.body.style.overflow = 'auto';
        }

        // Load dashboard statistics
        function loadDashboardData() {
            const assignments = JSON.parse(localStorage.getItem('vrClassAssignments') || '[]');
            const quizzes = JSON.parse(localStorage.getItem('vrClassQuizzes') || '[]');
            
            // Filter active assignments and quizzes
            const activeAssignments = assignments.filter(a => a.publishedToStudents && a.isActive);
            const activeQuizzes = quizzes.filter(q => q.publishedToStudents && q.isActive);
            
            // Calculate completed tasks
            const completedAssignments = activeAssignments.filter(a => 
                a.submissions.some(s => s.studentId === currentStudent.id)
            ).length;
            
            const completedQuizzes = activeQuizzes.filter(q => 
                q.attempts.some(a => a.studentId === currentStudent.id)
            ).length;
            
            // Calculate average score
            const quizAttempts = activeQuizzes.filter(q => 
                q.attempts.some(a => a.studentId === currentStudent.id)
            );
            
            let averageScore = 0;
            if (quizAttempts.length > 0) {
                const totalScore = quizAttempts.reduce((sum, quiz) => {
                    const attempt = quiz.attempts.find(a => a.studentId === currentStudent.id);
                    return sum + (attempt ? attempt.score : 0);
                }, 0);
                averageScore = Math.round(totalScore / quizAttempts.length);
            }
            
            // Update dashboard stats
            document.getElementById('assignmentsCount').textContent = activeAssignments.length;
            document.getElementById('quizzesCount').textContent = activeQuizzes.length;
            document.getElementById('completedCount').textContent = completedAssignments + completedQuizzes;
            document.getElementById('averageScore').textContent = averageScore + '%';
        }

        // Load and display assignments
        function loadAssignments() {
            const assignments = JSON.parse(localStorage.getItem('vrClassAssignments') || '[]');
            const activeAssignments = assignments.filter(a => a.publishedToStudents && a.isActive);
            
            const assignmentsList = document.getElementById('assignmentsList');
            assignmentsList.innerHTML = '';
            
            if (activeAssignments.length === 0) {
                assignmentsList.innerHTML = '<div style="text-align: center; padding: 40px; opacity: 0.7;"><h3>üìö No Assignments Yet</h3><p>Your teachers haven\'t assigned any work yet. Check back later!</p></div>';
                return;
            }
            
            activeAssignments.forEach(assignment => {
                const isSubmitted = assignment.submissions.some(s => s.studentId === currentStudent.id);
                const dueDate = new Date(assignment.dueDate);
                const isOverdue = new Date() > dueDate;
                
                const assignmentDiv = document.createElement('div');
                assignmentDiv.className = 'content-item';
                assignmentDiv.innerHTML = `
                    <div class="content-title">
                        ${assignment.title}
                        ${isSubmitted ? '<span style="color: #00ff88; margin-left: 10px;">‚úÖ Submitted</span>' : 
                          isOverdue ? '<span style="color: #ff6b6b; margin-left: 10px;">‚è∞ Overdue</span>' : ''}
                    </div>
                    <div class="content-meta">
                        üë©‚Äçüè´ ${assignment.teacherName} ‚Ä¢ üìñ ${assignment.subject} ‚Ä¢ 
                        üìÖ Due: ${dueDate.toLocaleDateString()} ‚Ä¢ 
                        üéØ ${assignment.maxMarks} marks
                    </div>
                    <div class="content-description">
                        ${assignment.description}
                    </div>
                    <div style="margin-top: 15px;">
                        ${!isSubmitted ? 
                            `<button class="btn btn-primary" onclick="submitAssignment('${assignment.id}')">
                                üì§ Submit Assignment
                            </button>` : 
                            `<button class="btn btn-secondary" onclick="viewSubmission('${assignment.id}')">
                                üëÅÔ∏è View Submission
                            </button>`
                        }
                    </div>
                `;
                assignmentsList.appendChild(assignmentDiv);
            });
        }

        // Load and display quizzes
        function loadQuizzes() {
            const quizzes = JSON.parse(localStorage.getItem('vrClassQuizzes') || '[]');
            const activeQuizzes = quizzes.filter(q => q.publishedToStudents && q.isActive);
            
            const quizzesList = document.getElementById('quizzesList');
            quizzesList.innerHTML = '';
            
            if (activeQuizzes.length === 0) {
                quizzesList.innerHTML = '<div style="text-align: center; padding: 40px; opacity: 0.7;"><h3>üìù No Quizzes Available</h3><p>No quizzes have been published yet. Stay tuned!</p></div>';
                return;
            }
            
            activeQuizzes.forEach(quiz => {
                const hasAttempted = quiz.attempts.some(a => a.studentId === currentStudent.id);
                const dueDate = new Date(quiz.dueDate);
                const isOverdue = new Date() > dueDate;
                
                let scoreText = '';
                if (hasAttempted) {
                    const attempt = quiz.attempts.find(a => a.studentId === currentStudent.id);
                    scoreText = `<span style="color: #00ff88;">Score: ${attempt.score}%</span>`;
                }
                
                const quizDiv = document.createElement('div');
                quizDiv.className = 'content-item';
                quizDiv.innerHTML = `
                    <div class="content-title">
                        ${quiz.title}
                        ${hasAttempted ? '<span style="color: #00ff88; margin-left: 10px;">‚úÖ Completed</span>' : 
                          isOverdue ? '<span style="color: #ff6b6b; margin-left: 10px;">‚è∞ Expired</span>' : ''}
                    </div>
                    <div class="content-meta">
                        üë©‚Äçüè´ ${quiz.teacherName} ‚Ä¢ üìñ ${quiz.subject} ‚Ä¢ 
                        ‚è±Ô∏è ${quiz.duration} minutes ‚Ä¢ 
                        üìÖ Due: ${dueDate.toLocaleDateString()}
                        ${scoreText ? ' ‚Ä¢ ' + scoreText : ''}
                    </div>
                    <div class="content-description">
                        üìä ${quiz.questions.length} questions ‚Ä¢ Multiple choice format
                    </div>
                    <div style="margin-top: 15px;">
                        ${!hasAttempted && !isOverdue ? 
                            `<button class="btn btn-primary" onclick="startQuiz('${quiz.id}')">
                                üöÄ Start Quiz
                            </button>` : 
                            hasAttempted ?
                            `<button class="btn btn-secondary" onclick="viewQuizResults('${quiz.id}')">
                                üìä View Results
                            </button>` : 
                            `<button class="btn btn-secondary" disabled>
                                ‚è∞ Quiz Expired
                            </button>`
                        }
                    </div>
                `;
                quizzesList.appendChild(quizDiv);
            });
        }

        // Submit assignment
        function submitAssignment(assignmentId) {
            const assignments = JSON.parse(localStorage.getItem('vrClassAssignments') || '[]');
            const assignment = assignments.find(a => a.id == assignmentId);
            
            if (!assignment) {
                alert('Assignment not found!');
                return;
            }
            
            const submission = prompt(`Submit your assignment: "${assignment.title}"\n\nEnter your submission text or file description:`);
            
            if (submission) {
                const submissionData = {
                    studentId: currentStudent.id,
                    studentName: currentStudent.name,
                    submissionText: submission,
                    submittedAt: new Date().toISOString(),
                    status: 'Submitted',
                    grade: null
                };
                
                assignment.submissions.push(submissionData);
                localStorage.setItem('vrClassAssignments', JSON.stringify(assignments));
                
                alert('Assignment submitted successfully! üéâ');
                loadAssignments();
                loadDashboardData();
            }
        }

        // Start quiz
        function startQuiz(quizId) {
            const quizzes = JSON.parse(localStorage.getItem('vrClassQuizzes') || '[]');
            currentQuiz = quizzes.find(q => q.id == quizId);
            
            if (!currentQuiz) {
                alert('Quiz not found!');
                return;
            }
            
            // Check if quiz is still available
            const dueDate = new Date(currentQuiz.dueDate);
            if (new Date() > dueDate) {
                alert('This quiz has expired!');
                return;
            }
            
            quizStartTime = new Date();
            quizAnswers = {};
            
            closeModal('quizzesModal');
            displayQuiz();
        }

        // Display quiz interface
        function displayQuiz() {
            document.getElementById('quizTitle').textContent = `üìù ${currentQuiz.title}`;
            
            const quizContent = document.getElementById('quizContent');
            quizContent.innerHTML = `
                <div style="text-align: center; margin-bottom: 30px; padding: 20px; background: rgba(0, 255, 136, 0.1); border-radius: 10px;">
                    <h3 style="color: #00ff88; margin-bottom: 10px;">Quiz Instructions</h3>
                    <p style="margin-bottom: 10px;">‚è±Ô∏è Duration: ${currentQuiz.duration} minutes</p>
                    <p style="margin-bottom: 10px;">üìä Questions: ${currentQuiz.questions.length}</p>
                    <p style="color: #ff6b6b;">‚ö†Ô∏è Once started, you cannot pause or restart the quiz!</p>
                    <div id="quizTimer" style="font-size: 1.5rem; color: #00ff88; margin-top: 15px; font-weight: bold;"></div>
                </div>
                <div id="quizQuestions"></div>
                <div style="text-align: center; margin-top: 30px;">
                    <button class="btn btn-primary" onclick="submitQuiz()" style="padding: 15px 40px; font-size: 1.1rem;">
                        üì§ Submit Quiz
                    </button>
                </div>
            `;
            
            // Display questions
            const questionsDiv = document.getElementById('quizQuestions');
            currentQuiz.questions.forEach((question, index) => {
                const questionDiv = document.createElement('div');
                questionDiv.style.cssText = 'margin-bottom: 30px; padding: 20px; background: rgba(0, 0, 0, 0.5); border-radius: 15px; border: 1px solid rgba(0, 255, 136, 0.2);';
                
                questionDiv.innerHTML = `
                    <h4 style="color: #00ff88; margin-bottom: 15px;">Question ${index + 1}</h4>
                    <p style="margin-bottom: 20px; font-size: 1.1rem;">${question.question}</p>
                    <div style="display: grid; gap: 10px;">
                        ${question.options.map((option, optIndex) => `
                            <label style="display: flex; align-items: center; gap: 10px; padding: 10px; background: rgba(0, 0, 0, 0.3); border-radius: 8px; cursor: pointer; transition: all 0.3s ease;" 
                                   onmouseover="this.style.background='rgba(0, 255, 136, 0.1)'" 
                                   onmouseout="this.style.background='rgba(0, 0, 0, 0.3)'">
                                <input type="radio" name="question_${index}" value="${String.fromCharCode(65 + optIndex)}" 
                                       onchange="quizAnswers[${index}] = this.value" style="transform: scale(1.2);">
                                <span>${String.fromCharCode(65 + optIndex)}. ${option}</span>
                            </label>
                        `).join('')}
                    </div>
                `;
                questionsDiv.appendChild(questionDiv);
            });
            
            // Start quiz timer
            startQuizTimer();
            openModal('quizTakingModal');
        }

        // Start quiz timer
        function startQuizTimer() {
            const duration = currentQuiz.duration * 60; // Convert to seconds
            let timeLeft = duration;
            
            const timerInterval = setInterval(() => {
                const minutes = Math.floor(timeLeft / 60);
                const seconds = timeLeft % 60;
                
                document.getElementById('quizTimer').textContent = 
                    `‚è±Ô∏è Time Left: ${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                
                if (timeLeft <= 0) {
                    clearInterval(timerInterval);
                    alert('Time is up! Your quiz will be submitted automatically.');
                    submitQuiz();
                }
                
                timeLeft--;
            }, 1000);
        }

        // Submit quiz
        function submitQuiz() {
            if (Object.keys(quizAnswers).length < currentQuiz.questions.length) {
                if (!confirm('You haven\'t answered all questions. Are you sure you want to submit?')) {
                    return;
                }
            }
            
            // Calculate score
            let correctAnswers = 0;
            currentQuiz.questions.forEach((question, index) => {
                if (quizAnswers[index] === question.correctAnswer) {
                    correctAnswers++;
                }
            });
            
            const score = Math.round((correctAnswers / currentQuiz.questions.length) * 100);
            
            // Save quiz attempt
            const attempt = {
                studentId: currentStudent.id,
                studentName: currentStudent.name,
                answers: quizAnswers,
                score: score,
                correctAnswers: correctAnswers,
                totalQuestions: currentQuiz.questions.length,
                startTime: quizStartTime.toISOString(),
                submitTime: new Date().toISOString()
            };
            
            const quizzes = JSON.parse(localStorage.getItem('vrClassQuizzes') || '[]');
            const quiz = quizzes.find(q => q.id === currentQuiz.id);
            quiz.attempts.push(attempt);
            localStorage.setItem('vrClassQuizzes', JSON.stringify(quizzes));
            
            closeQuizModal();
            
            // Show results
            alert(`Quiz completed! üéâ\n\nYour Score: ${score}%\nCorrect Answers: ${correctAnswers}/${currentQuiz.questions.length}`);
            
            loadDashboardData();
            loadQuizzes();
        }

        function closeQuizModal() {
            closeModal('quizTakingModal');
            currentQuiz = null;
            quizStartTime = null;
            quizAnswers = {};
        }

        // Load and display notifications
        function loadNotifications() {
            const notifications = JSON.parse(localStorage.getItem('studentNotifications') || '[]');
            return notifications;
        }

        function displayNotifications() {
            const notifications = loadNotifications();
            const notificationsList = document.getElementById('notificationsList');
            
            if (notifications.length === 0) {
                notificationsList.innerHTML = '<div style="text-align: center; padding: 40px; opacity: 0.7;"><h3>üîî No Notifications</h3><p>You\'re all caught up!</p></div>';
                return;
            }
            
            notificationsList.innerHTML = '';
            notifications.forEach(notification => {
                const notificationDiv = document.createElement('div');
                notificationDiv.className = 'content-item';
                notificationDiv.style.cssText = `background: ${notification.read ? 'rgba(0, 0, 0, 0.3)' : 'rgba(0, 255, 136, 0.1)'}; border-left: 3px solid ${notification.read ? '#666' : '#00ff88'};`;
                
                notificationDiv.innerHTML = `
                    <div class="content-title" style="display: flex; justify-content: space-between; align-items: center;">
                        ${notification.title}
                        ${!notification.read ? '<span style="color: #00ff88;">‚óè</span>' : ''}
                    </div>
                    <div class="content-meta">
                        üìÖ ${new Date(notification.timestamp).toLocaleString()}
                    </div>
                    <div class="content-description">
                        ${notification.message}
                    </div>
                `;
                
                notificationDiv.addEventListener('click', () => {
                    markNotificationAsRead(notification.id);
                });
                
                notificationsList.appendChild(notificationDiv);
            });
        }

        function updateNotificationBell() {
            const notifications = loadNotifications();
            const unreadCount = notifications.filter(n => !n.read).length;
            
            const countElement = document.getElementById('notificationCount');
            if (unreadCount > 0) {
                countElement.textContent = unreadCount;
                countElement.style.display = 'flex';
            } else {
                countElement.style.display = 'none';
            }
        }

        function markNotificationAsRead(notificationId) {
            const notifications = loadNotifications();
            const notification = notifications.find(n => n.id === notificationId);
            if (notification) {
                notification.read = true;
                localStorage.setItem('studentNotifications', JSON.stringify(notifications));
                updateNotificationBell();
                displayNotifications();
            }
        }

        function markAllAsRead() {
            const notifications = loadNotifications();
            notifications.forEach(n => n.read = true);
            localStorage.setItem('studentNotifications', JSON.stringify(notifications));
            updateNotificationBell();
            displayNotifications();
        }

        // Load progress report
        function loadProgress() {
            const progressContent = document.getElementById('progressContent');
            const assignments = JSON.parse(localStorage.getItem('vrClassAssignments') || '[]');
            const quizzes = JSON.parse(localStorage.getItem('vrClassQuizzes') || '[]');
            
            // Calculate statistics
            const submittedAssignments = assignments.filter(a => 
                a.submissions.some(s => s.studentId === currentStudent.id)
            ).length;
            
            const completedQuizzes = quizzes.filter(q => 
                q.attempts.some(a => a.studentId === currentStudent.id)
            );
            
            const averageScore = completedQuizzes.length > 0 ? 
                completedQuizzes.reduce((sum, quiz) => {
                    const attempt = quiz.attempts.find(a => a.studentId === currentStudent.id);
                    return sum + (attempt ? attempt.score : 0);
                }, 0) / completedQuizzes.length : 0;
            
            progressContent.innerHTML = `
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 30px;">
                    <div class="stat-card">
                        <div class="stat-number">${submittedAssignments}</div>
                        <div class="stat-label">Assignments Submitted</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">${completedQuizzes.length}</div>
                        <div class="stat-label">Quizzes Completed</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">${Math.round(averageScore)}%</div>
                        <div class="stat-label">Average Quiz Score</div>
                    </div>
                </div>
                
                <div style="margin-bottom: 30px;">
                    <h3 style="color: #00ff88; margin-bottom: 15px;">üìà Recent Quiz Performance</h3>
                    <div style="background: rgba(0, 0, 0, 0.5); border-radius: 10px; padding: 20px;">
                        ${completedQuizzes.length > 0 ? 
                            completedQuizzes.slice(0, 5).map(quiz => {
                                const attempt = quiz.attempts.find(a => a.studentId === currentStudent.id);
                                return `
                                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 10px 0; border-bottom: 1px solid rgba(0, 255, 136, 0.1);">
                                        <span>${quiz.title}</span>
                                        <span style="color: ${attempt.score >= 70 ? '#00ff88' : attempt.score >= 50 ? '#ffaa00' : '#ff6b6b'}; font-weight: bold;">
                                            ${attempt.score}%
                                        </span>
                                    </div>
                                `;
                            }).join('') :
                            '<p style="text-align: center; opacity: 0.7;">No quiz attempts yet</p>'
                        }
                    </div>
                </div>
                
                <div>
                    <h3 style="color: #00ff88; margin-bottom: 15px;">üéØ Learning Goals</h3>
                    <div style="background: rgba(0, 0, 0, 0.5); border-radius: 10px; padding: 20px;">
                        <p>üéì Complete all assigned work on time</p>
                        <p>üìä Maintain an average score above 80%</p>
                        <p>ü•Ω Participate actively in VR lessons</p>
                        <p>üí¨ Engage with teachers and peers</p>
                    </div>
                </div>
            `;
        }

        function logout() {
            if (confirm('Are you sure you want to logout?')) {
                localStorage.removeItem('vrClassCurrentUser');
                window.location.href = 'index.html';
            }
        }

        // Study Groups Functions
        function loadStudyGroups() {
            const studyGroups = JSON.parse(localStorage.getItem('vrClassStudyGroups') || '[]');
            const studyGroupsList = document.getElementById('studyGroupsList');
            
            if (studyGroups.length === 0) {
                studyGroupsList.innerHTML = `
                    <div style="text-align: center; padding: 40px; opacity: 0.7;">
                        <h3>üë• No Study Groups Yet</h3>
                        <p>Create or join a study group to collaborate with your classmates!</p>
                    </div>
                `;
                return;
            }
            
            studyGroupsList.innerHTML = '';
            studyGroups.forEach(group => {
                const isMember = group.members.some(m => m.id === currentStudent.id);
                
                const groupDiv = document.createElement('div');
                groupDiv.className = 'content-item';
                groupDiv.innerHTML = `
                    <div class="content-title">
                        ${group.name}
                        ${isMember ? '<span style="color: #00ff88; margin-left: 10px;">‚úÖ Member</span>' : ''}
                    </div>
                    <div class="content-meta">
                        üìñ ${group.subject} ‚Ä¢ üë• ${group.members.length} members ‚Ä¢ 
                        üë§ Created by ${group.creator}
                    </div>
                    <div class="content-description">
                        ${group.description}
                    </div>
                    <div style="margin-top: 15px;">
                        ${isMember ? 
                            `<button class="btn btn-primary" onclick="openStudyGroup('${group.id}')">
                                üí¨ Open Group Chat
                            </button>
                            <button class="btn btn-secondary" onclick="leaveStudyGroup('${group.id}')" style="margin-left: 10px;">
                                üö™ Leave Group
                            </button>` : 
                            `<button class="btn btn-primary" onclick="joinSpecificGroup('${group.id}')">
                                üîó Join Group
                            </button>`
                        }
                    </div>
                `;
                studyGroupsList.appendChild(groupDiv);
            });
        }

        function createStudyGroup() {
            const groupName = prompt('Enter study group name:');
            if (!groupName) return;
            
            const subject = prompt('Enter subject (e.g., Mathematics, Science, History):');
            if (!subject) return;
            
            const description = prompt('Enter group description:');
            if (!description) return;
            
            const newGroup = {
                id: Date.now().toString(),
                name: groupName,
                subject: subject,
                description: description,
                creator: currentStudent.name,
                createdAt: new Date().toISOString(),
                members: [{
                    id: currentStudent.id,
                    name: currentStudent.name,
                    role: 'admin'
                }],
                messages: []
            };
            
            const studyGroups = JSON.parse(localStorage.getItem('vrClassStudyGroups') || '[]');
            studyGroups.push(newGroup);
            localStorage.setItem('vrClassStudyGroups', JSON.stringify(studyGroups));
            
            alert(`Study group "${groupName}" created successfully! üéâ`);
            loadStudyGroups();
        }

        function joinStudyGroup() {
            const groupCode = prompt('Enter study group code or name to join:');
            if (!groupCode) return;
            
            const studyGroups = JSON.parse(localStorage.getItem('vrClassStudyGroups') || '[]');
            const group = studyGroups.find(g => 
                g.name.toLowerCase().includes(groupCode.toLowerCase()) || 
                g.id === groupCode
            );
            
            if (!group) {
                alert('Study group not found! Please check the group name or code.');
                return;
            }
            
            const isMember = group.members.some(m => m.id === currentStudent.id);
            if (isMember) {
                alert('You are already a member of this group!');
                return;
            }
            
            group.members.push({
                id: currentStudent.id,
                name: currentStudent.name,
                role: 'member'
            });
            
            localStorage.setItem('vrClassStudyGroups', JSON.stringify(studyGroups));
            alert(`Successfully joined "${group.name}"! üéâ`);
            loadStudyGroups();
        }

        function joinSpecificGroup(groupId) {
            const studyGroups = JSON.parse(localStorage.getItem('vrClassStudyGroups') || '[]');
            const group = studyGroups.find(g => g.id === groupId);
            
            if (!group) return;
            
            const isMember = group.members.some(m => m.id === currentStudent.id);
            if (isMember) {
                alert('You are already a member of this group!');
                return;
            }
            
            group.members.push({
                id: currentStudent.id,
                name: currentStudent.name,
                role: 'member'
            });
            
            localStorage.setItem('vrClassStudyGroups', JSON.stringify(studyGroups));
            alert(`Successfully joined "${group.name}"! üéâ`);
            loadStudyGroups();
        }

        function leaveStudyGroup(groupId) {
            if (!confirm('Are you sure you want to leave this study group?')) return;
            
            const studyGroups = JSON.parse(localStorage.getItem('vrClassStudyGroups') || '[]');
            const group = studyGroups.find(g => g.id === groupId);
            
            if (!group) return;
            
            group.members = group.members.filter(m => m.id !== currentStudent.id);
            localStorage.setItem('vrClassStudyGroups', JSON.stringify(studyGroups));
            
            alert('You have left the study group.');
            loadStudyGroups();
        }

        function openStudyGroup(groupId) {
            // In a real app, this would open a dedicated group chat interface
            alert('Opening study group chat... üí¨\n\nThis would connect you to the group chat interface where you can:\n‚Ä¢ Chat with group members\n‚Ä¢ Share study materials\n‚Ä¢ Schedule study sessions\n‚Ä¢ Collaborate on assignments');
        }

        // Close modals when clicking outside
        document.querySelectorAll('.modal').forEach(modal => {
            modal.addEventListener('click', function(e) {
                if (e.target === this) {
                    closeModal(this.id);
                }
            });
        });

        // Update notification bell periodically
        setInterval(updateNotificationBell, 5000);
    </script>
</body>
</html>
